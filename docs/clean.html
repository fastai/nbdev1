---

title: Clean notebooks

keywords: fastai
sidebar: home_sidebar

summary: "Strip notebooks from superfluous metadata"
description: "Strip notebooks from superfluous metadata"
nb_path: "nbs/07_clean.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/07_clean.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To avoid pointless conflicts while working with jupyter notebooks (with different execution counts or cell metadata), it is recommended to clean the notebooks before committing anything (done automatically if you install the git hooks with <a href="/cli.html#nbdev_install_git_hooks"><code>nbdev_install_git_hooks</code></a>). The following functions are used to do that.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Utils">Utils<a class="anchor-link" href="#Utils"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rm_execution_count" class="doc_header"><code>rm_execution_count</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/clean.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rm_execution_count</code>(<strong><code>o</code></strong>)</p>
</blockquote>
<p>Remove execution count in <code>o</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_output_data_vnd" class="doc_header"><code>clean_output_data_vnd</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/clean.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_output_data_vnd</code>(<strong><code>o</code></strong>)</p>
</blockquote>
<p>Remove <code>application/vnd.google.colaboratory.intrinsic+json</code> in data entries</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_cell_output" class="doc_header"><code>clean_cell_output</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/clean.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_cell_output</code>(<strong><code>cell</code></strong>)</p>
</blockquote>
<p>Remove execution count in <code>cell</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_cell" class="doc_header"><code>clean_cell</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/clean.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_cell</code>(<strong><code>cell</code></strong>, <strong><code>clear_all</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Clean <code>cell</code> by removing superfluous metadata or everything except the input if <code>clear_all</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
       <span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>
       <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hide_input&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">},</span>
       <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
                    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;application/vnd.google.colaboratory.intrinsic+json&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;plain/text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sample output&#39;</span><span class="p">,]</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;super&#39;</span><span class="p">}],</span>
       
       <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;awesome_code&#39;</span><span class="p">}</span>
<span class="n">tst1</span> <span class="o">=</span> <span class="n">tst</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">clean_cell</span><span class="p">(</span><span class="n">tst</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
              <span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hide_input&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
              <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                           <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;plain/text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sample output&#39;</span><span class="p">,]},</span>
                           <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;super&#39;</span><span class="p">}],</span>
              <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;awesome_code&#39;</span><span class="p">})</span>

<span class="n">clean_cell</span><span class="p">(</span><span class="n">tst1</span><span class="p">,</span> <span class="n">clear_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
               <span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{},</span>
               <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[],</span>
               <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;awesome_code&#39;</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst2</span> <span class="o">=</span> <span class="p">{</span>
       <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;tags&#39;</span><span class="p">:[]},</span>
       <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;tags&#39;</span><span class="p">:[]</span>
                    <span class="p">}}],</span>
       
          <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;&quot;</span>
   <span class="p">]}</span>
<span class="n">clean_cell</span><span class="p">(</span><span class="n">tst2</span><span class="p">,</span> <span class="n">clear_all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst2</span><span class="p">,</span> <span class="p">{</span>
               <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{},</span>
               <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="s1">&#39;metadata&#39;</span><span class="p">:{}}],</span>
               <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="p">[]})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_nb" class="doc_header"><code>clean_nb</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/clean.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_nb</code>(<strong><code>nb</code></strong>, <strong><code>clear_all</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Clean <code>nb</code> from superfluous metadata, passing <code>clear_all</code> to <a href="/clean.html#clean_cell"><code>clean_cell</code></a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
       <span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>
       <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hide_input&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">},</span>
       <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;application/vnd.google.colaboratory.intrinsic+json&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                        <span class="s1">&#39;plain/text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sample output&#39;</span><span class="p">,]</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;super&#39;</span><span class="p">}],</span>
       <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;awesome_code&#39;</span><span class="p">}</span>
<span class="n">nb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;kernelspec&#39;</span><span class="p">:</span> <span class="s1">&#39;some_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;jekyll&#39;</span><span class="p">:</span> <span class="s1">&#39;some_meta&#39;</span><span class="p">,</span> <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="mi">37</span><span class="p">},</span>
      <span class="s1">&#39;cells&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tst</span><span class="p">]}</span>

<span class="n">clean_nb</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
              <span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hide_input&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
              <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                           <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;plain/text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sample output&#39;</span><span class="p">,]},</span>
                           <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;super&#39;</span><span class="p">}],</span>
              <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;awesome_code&#39;</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nb</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;kernelspec&#39;</span><span class="p">:</span> <span class="s1">&#39;some_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;jekyll&#39;</span><span class="p">:</span> <span class="s1">&#39;some_meta&#39;</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Main-function">Main function<a class="anchor-link" href="#Main-function"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nbdev_clean_nbs" class="doc_header"><code>nbdev_clean_nbs</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/clean.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nbdev_clean_nbs</code>(<strong><code>fname</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>clear_all</code></strong>:<code>bool_arg</code>=<em><code>False</code></em>, <strong><code>disp</code></strong>:<code>bool_arg</code>=<em><code>False</code></em>, <strong><code>read_input_stream</code></strong>:<code>bool_arg</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Clean all notebooks in <code>fname</code> to avoid merge conflicts</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>fname</code></strong></td>
<td><code>str</code></td>
<td><code>None</code></td>
<td>A notebook name or glob to convert</td>
</tr>
<tr>
<td><strong><code>clear_all</code></strong></td>
<td><code>bool_arg</code></td>
<td><code>False</code></td>
<td>Clean all metadata and outputs</td>
</tr>
<tr>
<td><strong><code>disp</code></strong></td>
<td><code>bool_arg</code></td>
<td><code>False</code></td>
<td>Print the cleaned outputs</td>
</tr>
<tr>
<td><strong><code>read_input_stream</code></strong></td>
<td><code>bool_arg</code></td>
<td><code>False</code></td>
<td>Read input stram and not nb folder</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By default (<code>fname</code> left to <code>None</code>), the all the notebooks in <code>lib_folder</code> are cleaned. You can opt in to fully clean the notebook by removing every bit of metadata and the cell outputs by passing <code>clear_all=True</code>. <code>disp</code> is only used for internal use with git hooks and will print the clean notebook instead of saving it. Same for <code>read_input_stream</code> that will read the notebook from the input stream instead of the file names.</p>

</div>
</div>
</div>
</div>


